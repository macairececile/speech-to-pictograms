import pandas as pd

import csv

punctuations = '!?\":,/.;()[]*'
punc_table = str.maketrans({key: None for key in punctuations})

def process_whisper_output(text):
    """
        Process the prediction from whisper model

        Arguments
        ---------
        text: str

        Returns
        -------
        The processed text.
    """
    t = text.replace('\n', '')
    a = t.translate(punc_table)
    b = a.replace('-', ' ').replace("«", " ").replace("»", " ")
    return ''.join(b.lower().strip())


def get_data_from_whisper():
    """
    Read the data generated by whisper.

    Args:
        directory (str): The directory path.
        model_prefix (str): The prefix for the model.
        corpus_name (str): The name of the corpus.

    Returns:
        list: The predictions of the whisper model.
    """
    file_path = "/gpfswork/rech/czj/uef37or/ASR_S2P_data/propicto_eval/wav2vec2_propicto_eval_process.txt"
    f = open(file_path, 'r')
    preds = [process_whisper_output(row[1]) for row in csv.reader(f, delimiter='\t')]
    f.close()
    return preds


def create_file(sentences):
    f = open("/gpfswork/rech/czj/uef37or/NMT_transformers/propicto_eval/asr_wav2vec/"+ "propicto_eval.fr", "w")
    for s in sentences:
        f.write(str(s) + "\n")
    f.close()


def get_text_and_generate_file():
    src_sentences = get_data_from_whisper()
    create_file(src_sentences)


if __name__ == '__main__':
    get_text_and_generate_file()
